<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Report ‚Ä¢ First Aid App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/report.css">
</head>

<!-- EARLY SESSION CHECK (Prevents flash of restricted content) -->
<script>
  const user = JSON.parse(sessionStorage.getItem("faUser"));
  if (!user) window.location.replace("login.html");
</script>

<body>

<!-- MUST load before page logic -->
<script src="./js/session-check.js"></script>
<script src="./js/permissions-check.js"></script>

<!-- ============================
     TOP NAV BAR
============================ -->
<nav class="nav">
  <a class="nav-link-left" href="index.html">Dashboard</a>
  <span class="nav-title">Create Injury Report</span>
  <a class="nav-link-right" href="reportLogs.html">Logs</a>
</nav>

<main class="page">

  <!-- ============================
       STEP BAR
  ============================ -->
  <div class="step-bar">
    <div class="step active-step" id="stepLabel1">Patient</div>
    <div class="step" id="stepLabel2">Injury</div>
    <div class="step" id="stepLabel3">Discharge</div>
    <div class="step" id="stepLabel4">Review</div>
  </div>

  <!-- ============================
       FORM (WIZARD)
  ============================ -->
  <form id="injuryForm">

    <!-- STEP 1 -->
    <section class="card step-card active-step-card" id="step1">
      <h2 class="section-title">üßç Patient & Time</h2>

      <div class="field">
        <label>Time In (HHMM hrs)</label>
        <input id="timeIn" type="text" required placeholder="e.g. 0930">
      </div>

      <div class="field">
        <label>Time Out (HHMM hrs)</label>
        <input id="timeOut" type="text" required placeholder="e.g. 1045">
      </div>

      <div class="field">
        <label>Patient Name (Include Surname)</label>
        <input id="patientName" type="text" required placeholder="e.g. Tan Wei Ming">
      </div>

      <div class="field">
        <label>Gender</label>
        <select id="gender">
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>

      <div class="field">
        <label>Age</label>
        <input id="age" type="number" required placeholder="21">
      </div>

      <div class="field">
        <label>Contact Number</label>
        <input id="contact" type="text" placeholder="Optional">
      </div>

      <button type="button" class="btn primary" onclick="nextStep()">Next</button>
    </section>

    <!-- STEP 2 -->
    <section class="card step-card" id="step2">
      <h2 class="section-title">üí¢ Injury Details</h2>

      <div class="field">
        <label>Case Type</label>
        <select id="caseType">
          <option>P3</option>
          <option>P2</option>
          <option>P1</option>
        </select>
      </div>

      <div class="field">
        <label>Location</label>
        <input id="location" type="text" required placeholder="Where did the incident occur?">
      </div>

      <div class="field">
        <label>Mechanism of Injury (MOI)</label>
        <textarea id="moi" rows="3"></textarea>
      </div>

      <div class="field">
        <label>Treatment</label>
        <textarea id="treatment" rows="3"></textarea>
      </div>

      <div class="btn-row">
        <button type="button" class="btn secondary" onclick="prevStep()">Back</button>
        <button type="button" class="btn primary" onclick="nextStep()">Next</button>
      </div>
    </section>

    <!-- STEP 3 -->
    <section class="card step-card" id="step3">
      <h2 class="section-title">üöë Discharge Details</h2>

      <div class="field">
        <label>Discharge Method</label>
        <select id="discharge">
          <option value="self">Self-discharged</option>
          <option value="ambulance">Ambulance</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div id="ambulanceFields" class="hidden">
        <div class="field">
          <label>Ambulance Alpha No.</label>
          <input id="alphaNo" type="text" placeholder="A312">
        </div>

        <div class="field">
          <label>Receiving Hospital</label>
          <input id="hospital" type="text" placeholder="SGH">
        </div>

        <div class="field">
          <label>Paramedic Details</label>
          <input id="paramedic" type="text" placeholder="Name / Badge No.">
        </div>
      </div>

      <div class="field">
        <label>Other Discharge Method</label>
        <input id="dischargeOther" type="text" placeholder="Optional">
      </div>

      <div class="btn-row">
        <button type="button" class="btn secondary" onclick="prevStep()">Back</button>
        <button type="button" class="btn primary" onclick="nextStep()">Next</button>
      </div>
    </section>

    <!-- STEP 4 -->
    <section class="card step-card" id="step4">
      <h2 class="section-title">üìù Review</h2>

      <div id="previewBox" class="preview-box"></div>

      <div class="btn-row">
        <button type="button" id="copyButton" class="btn blue">Copy</button>
        <button type="submit" class="btn primary">Save Report</button>
        <button type="button" class="btn secondary" onclick="prevStep()">Back</button>
      </div>
    </section>

  </form>
</main>

<!-- Load wizard + Firestore submit logic -->
<script type="module" src="./js/report.js"></script>

</body>
</html>
